<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UI Component Designer Platform</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #2e7d32; /* Forest Green */
        --primary-light: #4caf50; /* Lighter shade of Forest Green */
        --primary-dark: #1b5e20; /* Darker shade of Forest Green */
        --secondary-color: #8d6e63; /* Earthy Brown */
        --secondary-light: #a1887f; /* Lighter shade of Earthy Brown */
        --accent-color: #ffc3b1; /* Accent color (can be adjusted) */
        --background-color: #faf3e0; /* Soft Cream */
        --card-bg: #faf3e0; /* White for cards */
        --text-primary: #2e7d32; /* Forest Green for text */
        --text-secondary: #5d4037; /* Darker Earthy Brown for secondary text */
        --text-light: #8d6e63; /* Earthy Brown for light text */
        --white: #ffffff; /* White */
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.15);
        --border-radius: 8px;
        --transition: all 0.3s ease;
      }

      /* Global Styles */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--text-primary);
        background-color: var(--background-color);
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background-color: var(--primary-color);
        color: var(--white);
      }

      .logo h1 {
        font-size: 1.5rem;
        font-weight: 600;
      }

      nav ul {
        display: flex;
        list-style: none;
        gap: 1rem;
      }

      button {
        cursor: pointer;
        padding: 0.5rem 1rem;
        background-color: var(--primary-light);
        color: var(--white);
        border: none;
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        transition: var(--transition);
      }

      button:hover {
        background-color: var(--primary-dark);
      }

      /* Main Workspace */
      .workspace {
        display: grid;
        grid-template-columns: 250px 1fr 300px;
        height: calc(100vh - 60px);
        overflow: hidden;
      }

      /* Components Panel */
      .components-panel {
        background-color: var(--card-bg);
        border-right: 1px solid var(--secondary-light);
        padding: 1rem;
        overflow-y: auto;
      }

      .components-panel h2 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--secondary-light);
      }

      .component-category {
        margin-bottom: 1.5rem;
      }

      .component-category h3 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
      }

      .component-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }

      .component-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.7rem;
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
        cursor: grab;
        transition: var(--transition);
      }

      .component-item:hover {
        background-color: var(--background-color);
      }

      .component-item i {
        font-size: 1.2rem;
        margin-bottom: 0.3rem;
        color: var(--primary-color);
      }

      .component-item span {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      /* Canvas */
      .canvas-container {
        position: relative;
        padding: 1rem;
        background-color: var(--card-bg);
        overflow: auto;
      }

      .device-selector {
        display: flex;
        justify-content: center;
        margin-bottom: 1rem;
        gap: 0.5rem;
      }

      .device-btn {
        background-color: var(--card-bg);
        color: var(--text-light);
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
      }

      .device-btn.active {
        background-color: var(--primary-color);
        color: var(--white);
        border-color: var(--primary-color);
      }

      .canvas {
        min-height: 600px;
        background-color: var(--card-bg);
        border: 1px solid var(--secondary-light);
        box-shadow: var(--shadow);
        transition: width 0.3s;
      }

      .desktop-view {
        width: 100%;
        margin: 0 auto;
      }

      .tablet-view {
        width: 768px;
        margin: 0 auto;
      }

      .mobile-view {
        width: 375px;
        margin: 0 auto;
      }

      /* Properties Panel */
      .properties-panel {
        background-color: var(--card-bg);
        border-left: 1px solid var(--secondary-light);
        padding: 1rem;
        overflow-y: auto;
      }

      .properties-panel h2 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--secondary-light);
      }

      .property-group {
        margin-bottom: 1.5rem;
      }

      .property-group h3 {
        font-size: 1rem;
        margin-bottom: 0.8rem;
        color: var(--text-secondary);
      }

      .property-row {
        display: flex;
        margin-bottom: 0.8rem;
        align-items: center;
      }

      .property-label {
        width: 40%;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .property-value {
        width: 60%;
      }

      .property-value input[type="text"],
      .property-value input[type="number"],
      .property-value select {
        width: 100%;
        padding: 0.4rem;
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
        font-size: 0.85rem;
      }

      .property-value input[type="color"] {
        width: 100%;
        height: 2rem;
      }

      .empty-message {
        text-align: center;
        color: var(--text-light);
        padding: 2rem 0;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
      }

      .modal-content {
        position: relative;
        background-color: var(--card-bg);
        margin: 5% auto;
        padding: 1.5rem;
        width: 70%;
        max-width: 900px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
      }

      .close {
        position: absolute;
        top: 1rem;
        right: 1.5rem;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-secondary);
      }

      .suggestion-tabs,
      .code-tabs {
        display: flex;
        margin: 1.5rem 0;
        border-bottom: 1px solid var(--secondary-light);
      }

      .tab-btn {
        background-color: transparent;
        color: var(--text-secondary);
        border: none;
        padding: 0.7rem 1.2rem;
        margin-right: 0.3rem;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        transition: var(--transition);
      }

      .tab-btn.active {
        background-color: var(--primary-color);
        color: var(--white);
      }

      .tab-pane {
        display: none;
        padding: 1rem 0;
      }

      .tab-pane.active {
        display: block;
      }

      .tab-pane h3 {
        margin-bottom: 1rem;
        font-size: 1.1rem;
        color: var(--text-primary);
      }

      .suggestions-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid var(--secondary-light);
        padding: 1rem;
        border-radius: var(--border-radius);
      }

      .suggestion-item {
        display: flex;
        align-items: flex-start;
        padding: 0.8rem;
        border-bottom: 1px solid var(--secondary-light);
      }

      .suggestion-item:last-child {
        border-bottom: none;
      }

      .suggestion-checkbox {
        margin-right: 1rem;
        margin-top: 0.2rem;
      }

      .suggestion-content p {
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
      }

      .suggestion-preview {
        display: inline-block;
        padding: 0.3rem 0.6rem;
        background-color: var(--background-color);
        border-radius: var(--border-radius);
        margin-top: 0.5rem;
        font-size: 0.85rem;
        border: 1px solid var(--secondary-light);
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.8rem;
        margin-top: 1.5rem;
      }

      textarea {
        width: 100%;
        height: 300px;
        font-family: monospace;
        padding: 1rem;
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
        resize: none;
        background-color: var(--card-bg);
        color: var(--text-secondary);
      }

      /* Canvas Elements (for dropped components) */
      .canvas-element {
        position: relative;
        border: 1px solid transparent;
        min-height: 30px;
        min-width: 30px;
        padding: 0.5rem;
        user-select: none;
        background-color: var(--card-bg);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
      }

      .canvas-element.selected {
        border: 1px dashed var(--primary-color);
      }

      .element-actions {
        position: absolute;
        top: -25px;
        right: 0;
        display: none;
        background-color: var(--primary-color);
        border-radius: var(--border-radius);
        padding: 0.2rem;
      }

      .canvas-element.selected .element-actions {
        display: flex;
      }

      .element-action-btn {
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
        margin-right: 0.2rem;
        background-color: transparent;
        color: var(--white);
        border: none;
      }

      .element-action-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      /* Component specific styles */
      .component-button {
        display: inline-block;
        padding: 0.5rem 1rem;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
      }

      .component-button:hover {
        background-color: var(--primary-dark);
      }

      .component-text {
        min-height: 1em;
        color: var(--text-primary);
      }

      .component-input {
        padding: 0.5rem;
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
        width: 100%;
        background-color: var(--card-bg);
        color: var(--text-secondary);
      }

      .component-image {
        max-width: 100%;
        height: auto;
        background-color: var(--background-color);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100px;
        border-radius: var(--border-radius);
      }

      .component-navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background-color: var(--primary-color);
        color: var(--white);
        border-radius: var(--border-radius);
      }

      .component-form {
        padding: 1rem;
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
        background-color: var(--card-bg);
      }

      .component-card {
        border: 1px solid var(--secondary-light);
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        background-color: var(--card-bg);
      }

      .component-card-header {
        padding: 1rem;
        background-color: var(--background-color);
        border-bottom: 1px solid var(--secondary-light);
      }

      .component-card-body {
        padding: 1rem;
      }

      .component-modal {
        position: relative;
        padding: 1rem;
        background-color: var(--card-bg);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        max-width: 500px;
        margin: 0 auto;
      }

      .component-modal-header {
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--secondary-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .component-modal-body {
        margin-bottom: 1rem;
      }

      .component-modal-footer {
        padding-top: 0.5rem;
        border-top: 1px solid var(--secondary-light);
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">
        <h1>CodeScript</h1>
      </div>
      <nav>
        <ul>
          <!-- <li><button id="save-btn">Save Project</button></li>
          <li><button id="load-btn">Load Project</button></li> -->
          <li>
            <button id="back-btn" href="/frontend/pages/index.html">
              Back
            </button>
          </li>
          <li><button id="export-btn">Export Code</button></li>
          <li><button id="ai-suggestions-btn">AI Suggestions</button></li>
        </ul>
      </nav>
    </header>

    <main>
      <div class="workspace">
        <div class="components-panel">
          <h2>Components</h2>
          <div class="component-category">
            <h3>Basic Elements</h3>
            <div class="component-list">
              <div
                class="component-item"
                draggable="true"
                data-component="button"
              >
                <i class="fas fa-square"></i>
                <span>Button</span>
              </div>
              <div
                class="component-item"
                draggable="true"
                data-component="text"
              >
                <i class="fas fa-font"></i>
                <span>Text</span>
              </div>
              <div
                class="component-item"
                draggable="true"
                data-component="input"
              >
                <i class="fas fa-keyboard"></i>
                <span>Input</span>
              </div>
              <div
                class="component-item"
                draggable="true"
                data-component="image"
              >
                <i class="fas fa-image"></i>
                <span>Image</span>
              </div>
            </div>
          </div>
          <div class="component-category">
            <h3>Advanced Components</h3>
            <div class="component-list">
              <div
                class="component-item"
                draggable="true"
                data-component="navbar"
              >
                <i class="fas fa-bars"></i>
                <span>Navbar</span>
              </div>
              <div
                class="component-item"
                draggable="true"
                data-component="form"
              >
                <i class="fas fa-wpforms"></i>
                <span>Form</span>
              </div>
              <div
                class="component-item"
                draggable="true"
                data-component="card"
              >
                <i class="fas fa-credit-card"></i>
                <span>Card</span>
              </div>
              <div
                class="component-item"
                draggable="true"
                data-component="modal"
              >
                <i class="fas fa-window-maximize"></i>
                <span>Modal</span>
              </div>
            </div>
          </div>
        </div>

        <div class="canvas-container">
          <div class="device-selector">
            <button class="device-btn active" data-device="desktop">
              <i class="fas fa-desktop"></i>
            </button>
            <button class="device-btn" data-device="tablet">
              <i class="fas fa-tablet-alt"></i>
            </button>
            <button class="device-btn" data-device="mobile">
              <i class="fas fa-mobile-alt"></i>
            </button>
          </div>
          <div id="canvas" class="canvas desktop-view">
            <!-- Canvas for drag and drop components -->
          </div>
        </div>

        <div class="properties-panel">
          <h2>Properties</h2>
          <div id="properties-content">
            <p class="empty-message">
              Select an element to edit its properties
            </p>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal for AI Suggestions -->
    <div id="ai-suggestions-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>AI Suggestions</h2>
        <div class="suggestion-tabs">
          <button class="tab-btn active" data-tab="layout">Layout</button>
          <button class="tab-btn" data-tab="colors">Colors</button>
          <button class="tab-btn" data-tab="accessibility">
            Accessibility
          </button>
          <button class="tab-btn" data-tab="responsive">
            Responsive Design
          </button>
        </div>
        <div class="tab-content">
          <div id="layout-tab" class="tab-pane active">
            <h3>Layout Suggestions</h3>
            <div id="layout-suggestions" class="suggestions-list">
              <p>Loading suggestions...</p>
            </div>
          </div>
          <div id="colors-tab" class="tab-pane">
            <h3>Color Scheme Suggestions</h3>
            <div id="color-suggestions" class="suggestions-list">
              <p>Loading suggestions...</p>
            </div>
          </div>
          <div id="accessibility-tab" class="tab-pane">
            <h3>Accessibility Improvements</h3>
            <div id="accessibility-suggestions" class="suggestions-list">
              <p>Loading suggestions...</p>
            </div>
          </div>
          <div id="responsive-tab" class="tab-pane">
            <h3>Responsive Design Suggestions</h3>
            <div id="responsive-suggestions" class="suggestions-list">
              <p>Loading suggestions...</p>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button id="apply-suggestions">Apply Selected Suggestions</button>
          <button id="close-suggestions">Close</button>
        </div>
      </div>
    </div>

    <!-- Modal for Export Code -->
    <div id="export-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Export Code</h2>
        <div class="code-tabs">
          <button class="tab-btn active" data-tab="html">HTML</button>
          <button class="tab-btn" data-tab="css">CSS</button>
        </div>
        <div class="tab-content">
          <div id="html-tab" class="tab-pane active">
            <textarea id="html-code" readonly></textarea>
          </div>
          <div id="css-tab" class="tab-pane">
            <textarea id="css-code" readonly></textarea>
          </div>
        </div>
        <div class="modal-actions">
          <button id="ai-improve-btn">Improve with AI</button>
          <button id="copy-code">Copy to Clipboard</button>
          <button id="download-code">Download Files</button>
          <button id="close-export">Close</button>
        </div>
      </div>
    </div>

    <script>
      // Initialize Back button
      const backBtn = document.getElementById("back-btn");

      backBtn.addEventListener("click", function () {
        // Go back to the previous page
        history.back();
      });
      // Main application JavaScript
      document.addEventListener("DOMContentLoaded", function () {
        // Elements
        const canvas = document.getElementById("canvas");
        const componentItems = document.querySelectorAll(".component-item");
        const deviceButtons = document.querySelectorAll(".device-btn");
        const propertiesContent = document.getElementById("properties-content");
        const aiSuggestionsBtn = document.getElementById("ai-suggestions-btn");
        const aiSuggestionsModal = document.getElementById(
          "ai-suggestions-modal"
        );
        const exportBtn = document.getElementById("export-btn");
        const exportModal = document.getElementById("export-modal");
        const saveBtn = document.getElementById("save-btn");
        const loadBtn = document.getElementById("load-btn");

        // Close buttons for modals
        const closeButtons = document.querySelectorAll(".close");
        const closeAiBtn = document.getElementById("close-suggestions");
        const closeExportBtn = document.getElementById("close-export");

        // Tab buttons
        const tabButtons = document.querySelectorAll(".tab-btn");

        // Apply suggestions button
        const applySuggestionsBtn =
          document.getElementById("apply-suggestions");

        // Export action buttons
        const copyCodeBtn = document.getElementById("copy-code");
        const downloadCodeBtn = document.getElementById("download-code");

        // State variables
        let selectedElement = null;
        let nextElementId = 1;

        // Component templates
        const componentTemplates = {
          button: {
            html: '<button class="component-button">Button</button>',
            defaultProperties: {
              text: "Button",
              backgroundColor: "#3498db",
              textColor: "#ffffff",
              borderRadius: "4",
              padding: "0.5rem 1rem",
              fontSize: "16",
            },
          },
          text: {
            html: '<div class="component-text">Text content</div>',
            defaultProperties: {
              text: "Text content",
              color: "#333333",
              fontSize: "16",
              fontWeight: "normal",
              textAlign: "left",
            },
          },
          input: {
            html: '<input type="text" class="component-input" placeholder="Input field">',
            defaultProperties: {
              placeholder: "Input field",
              width: "100%",
              padding: "0.5rem",
              borderColor: "#dddddd",
              borderRadius: "4",
            },
          },
          image: {
            html: '<div class="component-image"><i class="fas fa-image"></i> Image Placeholder</div>',
            defaultProperties: {
              width: "300",
              height: "200",
              alt: "Image",
            },
          },
          navbar: {
            html: `
                <div class="component-navbar">
                    <div class="navbar-brand">Brand</div>
                    <div class="navbar-links">
                        <span>Home</span>
                        <span>About</span>
                        <span>Services</span>
                        <span>Contact</span>
                    </div>
                </div>
            `,
            defaultProperties: {
              backgroundColor: "#2c3e50",
              textColor: "#ffffff",
              brandText: "Brand",
              links: "Home,About,Services,Contact",
            },
          },
          form: {
            html: `
                <div class="component-form">
                    <div style="margin-bottom:1rem;">
                        <label style="display:block;margin-bottom:0.5rem;">Name</label>
                        <input type="text" class="component-input" placeholder="Enter your name">
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label style="display:block;margin-bottom:0.5rem;">Email</label>
                        <input type="email" class="component-input" placeholder="Enter your email">
                    </div>
                    <div>
                        <button class="component-button">Submit</button>
                    </div>
                </div>
            `,
            defaultProperties: {
              backgroundColor: "#f9f9f9",
              borderColor: "#dddddd",
              buttonText: "Submit",
              buttonColor: "#3498db",
            },
          },
          card: {
            html: `
                <div class="component-card">
                    <div class="component-card-header">
                        <h3>Card Title</h3>
                    </div>
                    <div class="component-card-body">
                        <p>This is some sample content for the card. You can edit this text.</p>
                    </div>
                </div>
            `,
            defaultProperties: {
              title: "Card Title",
              content:
                "This is some sample content for the card. You can edit this text.",
              headerBgColor: "#f5f5f5",
              bodyBgColor: "#ffffff",
              borderColor: "#dddddd",
            },
          },
          modal: {
            html: `
                <div class="component-modal">
                    <div class="component-modal-header">
                        <h3>Modal Title</h3>
                        <span style="cursor:pointer;">×</span>
                    </div>
                    <div class="component-modal-body">
                        <p>This is the modal content. You can edit this text.</p>
                    </div>
                    <div class="component-modal-footer">
                        <button class="component-button" style="background-color:#6c757d;">Cancel</button>
                        <button class="component-button">Confirm</button>
                    </div>
                </div>
            `,
            defaultProperties: {
              title: "Modal Title",
              content: "This is the modal content. You can edit this text.",
              cancelButtonText: "Cancel",
              confirmButtonText: "Confirm",
              width: "500",
            },
          },
        };

        // Initialize drag and drop functionality
        initDragAndDrop();

        // Initialize device view switcher
        initDeviceButtons();

        // Initialize modal functionality
        initModals();

        // Initialize tab switching
        initTabs();

        // Initialize AI suggestions (simulated)
        initAiSuggestions();

        // Initialize export functionality
        initExportFunctionality();

        // Initialize save/load functionality
        initSaveLoad();

        // Drag and Drop implementation
        function initDragAndDrop() {
          // Make components draggable
          componentItems.forEach((item) => {
            item.addEventListener("dragstart", function (e) {
              e.dataTransfer.setData(
                "text/plain",
                this.getAttribute("data-component")
              );
            });
          });

          // Make canvas accept drops
          canvas.addEventListener("dragover", function (e) {
            e.preventDefault();
          });

          canvas.addEventListener("drop", function (e) {
            e.preventDefault();
            const componentType = e.dataTransfer.getData("text/plain");

            if (componentType) {
              const rect = canvas.getBoundingClientRect();
              const x = e.clientX - rect.left;
              const y = e.clientY - rect.top;

              addComponentToCanvas(componentType, x, y);
            }
          });

          // Handle canvas click for selection
          canvas.addEventListener("click", function (e) {
            const target = e.target.closest(".canvas-element");

            if (target) {
              selectElement(target);
            } else {
              deselectElements();
            }
          });
        }

        // Add component to canvas
        function addComponentToCanvas(componentType, x, y) {
          if (!componentTemplates[componentType]) return;

          const elementId = `element-${nextElementId++}`;
          const element = document.createElement("div");
          element.className = "canvas-element";
          element.id = elementId;
          element.setAttribute("data-component-type", componentType);
          element.innerHTML = `
            <div class="element-actions">
                <button class="element-action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="element-action-btn duplicate-btn" title="Duplicate">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
            ${componentTemplates[componentType].html}
        `;

          // Position the element at drop position
          element.style.position = "absolute";
          element.style.left = `${x}px`;
          element.style.top = `${y}px`;

          // Store default properties
          element.dataset.properties = JSON.stringify(
            componentTemplates[componentType].defaultProperties
          );

          canvas.appendChild(element);

          // Make element draggable within canvas
          makeElementDraggable(element);

          // Add event listeners for actions
          setupElementActions(element);

          // Select the new element
          selectElement(element);
        }

        // Make elements draggable within canvas
        function makeElementDraggable(element) {
          let pos1 = 0,
            pos2 = 0,
            pos3 = 0,
            pos4 = 0;

          element.addEventListener("mousedown", dragMouseDown);

          function dragMouseDown(e) {
            // Don't start dragging if clicking on action buttons
            if (e.target.closest(".element-actions")) {
              return;
            }

            e.preventDefault();
            // Get the mouse cursor position at startup
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.addEventListener("mouseup", closeDragElement);
            document.addEventListener("mousemove", elementDrag);

            // Select the element
            selectElement(element);
          }

          function elementDrag(e) {
            e.preventDefault();
            // Calculate the new cursor position
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;

            // Set the element's new position
            element.style.top = element.offsetTop - pos2 + "px";
            element.style.left = element.offsetLeft - pos1 + "px";
          }

          function closeDragElement() {
            // Stop moving when mouse button is released
            document.removeEventListener("mouseup", closeDragElement);
            document.removeEventListener("mousemove", elementDrag);
          }
        }

        // Set up action buttons for elements
        function setupElementActions(element) {
          const deleteBtn = element.querySelector(".delete-btn");
          const duplicateBtn = element.querySelector(".duplicate-btn");

          deleteBtn.addEventListener("click", function () {
            element.remove();
            // Clear properties panel if the selected element was deleted
            if (selectedElement === element) {
              selectedElement = null;
              showEmptyProperties();
            }
          });

          duplicateBtn.addEventListener("click", function () {
            const clone = element.cloneNode(true);
            const elementId = `element-${nextElementId++}`;
            clone.id = elementId;

            // Offset the position slightly
            const left = parseInt(element.style.left) + 20;
            const top = parseInt(element.style.top) + 20;
            clone.style.left = `${left}px`;
            clone.style.top = `${top}px`;

            canvas.appendChild(clone);

            // Make the clone draggable
            makeElementDraggable(clone);

            // Set up actions for the clone
            setupElementActions(clone);

            // Select the cloned element
            selectElement(clone);
          });
        }

        // Element selection
        function selectElement(element) {
          // Deselect previous element
          deselectElements();

          // Select new element
          element.classList.add("selected");
          selectedElement = element;

          // Show properties for the selected element
          showElementProperties(element);
        }

        function deselectElements() {
          const selected = document.querySelectorAll(
            ".canvas-element.selected"
          );
          selected.forEach((el) => {
            el.classList.remove("selected");
          });
          selectedElement = null;
        }

        // Show element properties in the properties panel
        function showElementProperties(element) {
          const componentType = element.getAttribute("data-component-type");
          const properties = JSON.parse(element.dataset.properties || "{}");

          let html = `<h3>${
            componentType.charAt(0).toUpperCase() + componentType.slice(1)
          } Properties</h3>`;

          // Common properties
          html += `
            <div class="property-group">
                <h3>Position & Size</h3>
                <div class="property-row">
                    <div class="property-label">X Position</div>
                    <div class="property-value">
                        <input type="number" id="prop-x" value="${parseInt(
                          element.style.left
                        )}">
                    </div>
                </div>
                <div class="property-row">
                    <div class="property-label">Y Position</div>
                    <div class="property-value">
                        <input type="number" id="prop-y" value="${parseInt(
                          element.style.top
                        )}">
                    </div>
                </div>
            </div>
        `;

          // Component-specific properties
          html += '<div class="property-group">';
          html += "<h3>Component Properties</h3>";

          for (const [key, value] of Object.entries(properties)) {
            if (
              key === "backgroundColor" ||
              key === "textColor" ||
              key === "borderColor" ||
              key === "headerBgColor" ||
              key === "bodyBgColor"
            ) {
              // Color picker for color properties
              html += `
                    <div class="property-row">
                        <div class="property-label">${formatPropertyLabel(
                          key
                        )}</div>
                        <div class="property-value">
                            <input type="color" id="prop-${key}" value="${value}">
                        </div>
                    </div>
                `;
            } else if (key === "text" || key === "content") {
              // Textarea for content
              html += `
                    <div class="property-row">
                        <div class="property-label">${formatPropertyLabel(
                          key
                        )}</div>
                        <div class="property-value">
                            <textarea id="prop-${key}" rows="3">${value}</textarea>
                        </div>
                    </div>
                `;
            } else {
              // Default text input
              html += `
                    <div class="property-row">
                        <div class="property-label">${formatPropertyLabel(
                          key
                        )}</div>
                        <div class="property-value">
                            <input type="text" id="prop-${key}" value="${value}">
                        </div>
                    </div>
                `;
            }
          }

          html += "</div>";

          propertiesContent.innerHTML = html;

          // Add event listeners to property inputs
          addPropertyEventListeners(element);
        }

        // Format property label (convert camelCase to Title Case with spaces)
        function formatPropertyLabel(property) {
          return property
            .replace(/([A-Z])/g, " $1")
            .replace(/^./, function (str) {
              return str.toUpperCase();
            });
        }

        // Add event listeners to property inputs
        function addPropertyEventListeners(element) {
          // Position listeners
          const xPosInput = document.getElementById("prop-x");
          const yPosInput = document.getElementById("prop-y");

          if (xPosInput) {
            xPosInput.addEventListener("change", function () {
              element.style.left = `${this.value}px`;
            });
          }

          if (yPosInput) {
            yPosInput.addEventListener("change", function () {
              element.style.top = `${this.value}px`;
            });
          }

          // Component-specific property listeners
          const properties = JSON.parse(element.dataset.properties || "{}");
          const componentType = element.getAttribute("data-component-type");

          for (const key of Object.keys(properties)) {
            const input = document.getElementById(`prop-${key}`);
            if (input) {
              input.addEventListener("change", function () {
                updateElementProperty(element, key, this.value);
              });
            }
          }
        }

        // Update element property
        function updateElementProperty(element, property, value) {
          const properties = JSON.parse(element.dataset.properties || "{}");
          properties[property] = value;
          element.dataset.properties = JSON.stringify(properties);

          // Update the visual component based on property
          const componentType = element.getAttribute("data-component-type");
          const componentElement =
            element.querySelector(`.component-${componentType}`) ||
            element.querySelector("input") ||
            element;

          switch (property) {
            case "text":
              if (componentType === "button") {
                componentElement.textContent = value;
              } else if (componentType === "text") {
                componentElement.textContent = value;
              }
              break;
            case "backgroundColor":
              componentElement.style.backgroundColor = value;
              break;
            case "textColor":
            case "color":
              componentElement.style.color = value;
              break;
            case "borderRadius":
              componentElement.style.borderRadius = `${value}px`;
              break;
            case "padding":
              componentElement.style.padding = value;
              break;
            case "fontSize":
              componentElement.style.fontSize = `${value}px`;
              break;
            case "fontWeight":
              componentElement.style.fontWeight = value;
              break;
            case "textAlign":
              componentElement.style.textAlign = value;
              break;
            case "width":
              if (value.includes("%")) {
                componentElement.style.width = value;
              } else {
                componentElement.style.width = `${value}px`;
              }
              break;
            case "height":
              componentElement.style.height = `${value}px`;
              break;
            case "placeholder":
              componentElement.placeholder = value;
              break;
            case "borderColor":
              componentElement.style.borderColor = value;
              break;
            case "title":
              const titleElement = element.querySelector("h3");
              if (titleElement) {
                titleElement.textContent = value;
              }
              break;
            case "content":
              const contentElement = element.querySelector("p");
              if (contentElement) {
                contentElement.textContent = value;
              }
              break;
          }
        }

        // Empty properties message
        function showEmptyProperties() {
          propertiesContent.innerHTML =
            '<p class="empty-message">Select an element to edit its properties</p>';
        }

        // Device view switcher
        function initDeviceButtons() {
          deviceButtons.forEach((btn) => {
            btn.addEventListener("click", function () {
              // Remove active class from all buttons
              deviceButtons.forEach((b) => b.classList.remove("active"));

              // Add active class to clicked button
              this.classList.add("active");

              // Update canvas view
              const device = this.getAttribute("data-device");
              canvas.className = `canvas ${device}-view`;
            });
          });
        }

        // Modal functionality
        function initModals() {
          // Open AI suggestions modal
          aiSuggestionsBtn.addEventListener("click", function () {
            aiSuggestionsModal.style.display = "block";
            // Load suggestions when modal is opened
            loadAiSuggestions();
          });

          // Open export modal
          exportBtn.addEventListener("click", function () {
            exportModal.style.display = "block";
            generateExportCode();
          });

          // Close modal with X button
          closeButtons.forEach((btn) => {
            btn.addEventListener("click", function () {
              const modal = this.closest(".modal");
              modal.style.display = "none";
            });
          });

          // Close AI suggestions modal with button
          closeAiBtn.addEventListener("click", function () {
            aiSuggestionsModal.style.display = "none";
          });

          // Close export modal with button
          closeExportBtn.addEventListener("click", function () {
            exportModal.style.display = "none";
          });

          // Close modals when clicking outside
          window.addEventListener("click", function (e) {
            if (e.target === aiSuggestionsModal) {
              aiSuggestionsModal.style.display = "none";
            } else if (e.target === exportModal) {
              exportModal.style.display = "none";
            }
          });
        }

        // Tab switching functionality
        function initTabs() {
          tabButtons.forEach((btn) => {
            btn.addEventListener("click", function () {
              const tabType = this.closest(".suggestion-tabs, .code-tabs");
              const tabName = this.getAttribute("data-tab");

              // Get all tab buttons in this tab group
              const buttons = tabType.querySelectorAll(".tab-btn");

              // Remove active class from all buttons in this group
              buttons.forEach((b) => b.classList.remove("active"));

              // Add active class to clicked button
              this.classList.add("active");

              // Hide all tab panes
              const tabContainer = tabType.nextElementSibling;
              const tabPanes = tabContainer.querySelectorAll(".tab-pane");
              tabPanes.forEach((pane) => pane.classList.remove("active"));

              // Show selected tab pane
              const activePane = document.getElementById(`${tabName}-tab`);
              if (activePane) {
                activePane.classList.add("active");
              }
            });
          });
        }

        // AI Suggestions functionality (simulated)
        function initAiSuggestions() {
          applySuggestionsBtn.addEventListener("click", function () {
            // Simulate applying AI suggestions
            const checkedSuggestions = document.querySelectorAll(
              ".suggestion-checkbox:checked"
            );

            if (checkedSuggestions.length > 0) {
              alert("Selected suggestions have been applied to your design!");
              aiSuggestionsModal.style.display = "none";
            } else {
              alert("No suggestions were selected.");
            }
          });
        }

        // Load AI suggestions (simulated)
        function loadAiSuggestions() {
          // Sample suggestions for different categories
          const layoutSuggestions =
            document.getElementById("layout-suggestions");
          const colorSuggestions = document.getElementById("color-suggestions");
          const accessibilitySuggestions = document.getElementById(
            "accessibility-suggestions"
          );
          const responsiveSuggestions = document.getElementById(
            "responsive-suggestions"
          );

          // Layout suggestions
          layoutSuggestions.innerHTML = `
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="layout-1">
                <div class="suggestion-content">
                    <p>Improve spacing between components for better visual hierarchy.</p>
                    <div class="suggestion-preview">Adds 1.5rem margins between sections</div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="layout-2">
                <div class="suggestion-content">
                    <p>Align form elements for better readability.</p>
                    <div class="suggestion-preview">Standardizes label and input alignment</div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="layout-3">
                <div class="suggestion-content">
                    <p>Adjust navigation bar layout for better balance.</p>
                    <div class="suggestion-preview">Distributes links evenly across navbar</div>
                </div>
            </div>
        `;

          // Color suggestions
          colorSuggestions.innerHTML = `
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="color-1">
                <div class="suggestion-content">
                    <p>Update color scheme for better contrast and visual appeal.</p>
                    <div class="suggestion-preview" style="display:flex;gap:0.5rem;">
                        <span style="display:inline-block;width:20px;height:20px;background:#3498db;"></span>
                        <span style="display:inline-block;width:20px;height:20px;background:#2c3e50;"></span>
                        <span style="display:inline-block;width:20px;height:20px;background:#ecf0f1;"></span>
                    </div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="color-2">
                <div class="suggestion-content">
                    <p>Enhance button visibility with color adjustment.</p>
                    <div class="suggestion-preview" style="display:flex;gap:0.5rem;">
                        <span style="display:inline-block;width:20px;height:20px;background:#e74c3c;"></span>
                        <span style="display:inline-block;width:20px;height:20px;background:#27ae60;"></span>
                    </div>
                </div>
            </div>
        `;

          // Accessibility suggestions
          accessibilitySuggestions.innerHTML = `
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="access-1">
                <div class="suggestion-content">
                    <p>Increase contrast for better readability.</p>
                    <div class="suggestion-preview">Adjusts text/background contrast ratio to 4.5:1</div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="access-2">
                <div class="suggestion-content">
                    <p>Add more descriptive button labels.</p>
                    <div class="suggestion-preview">Changes "Submit" to "Submit Form"</div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="access-3">
                <div class="suggestion-content">
                    <p>Increase font size for better readability.</p>
                    <div class="suggestion-preview">Increases base font size to 16px</div>
                </div>
            </div>
        `;

          // Responsive suggestions
          responsiveSuggestions.innerHTML = `
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="resp-1">
                <div class="suggestion-content">
                    <p>Optimize layout for mobile view.</p>
                    <div class="suggestion-preview">Stacks horizontal elements vertically</div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="resp-2">
                <div class="suggestion-content">
                    <p>Adjust button sizes for touch targets.</p>
                    <div class="suggestion-preview">Increases button size to min 44px height</div>
                </div>
            </div>
            <div class="suggestion-item">
                <input type="checkbox" class="suggestion-checkbox" id="resp-3">
                <div class="suggestion-content">
                    <p>Make navbar collapsible on small screens.</p>
                    <div class="suggestion-preview">Adds hamburger menu for mobile view</div>
                </div>
            </div>
        `;
        }

        // Export functionality
        function initExportFunctionality() {
          copyCodeBtn.addEventListener("click", function () {
            const activeTab = document
              .querySelector(".code-tabs .tab-btn.active")
              .getAttribute("data-tab");
            const codeElement = document.getElementById(`${activeTab}-code`);

            // Copy to clipboard
            codeElement.select();
            document.execCommand("copy");

            alert("Code copied to clipboard!");
          });

          downloadCodeBtn.addEventListener("click", function () {
            alert("Files have been prepared for download! (Simulation)");
          });
        }

        // Generate export code
        function generateExportCode() {
          const htmlCode = document.getElementById("html-code");
          const cssCode = document.getElementById("css-code");

          // Generate HTML from canvas elements
          let generatedHtml =
            '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Generated UI</title>\n    <link rel="stylesheet" href="styles.css">\n</head>\n<body>\n';

          // Get all elements from canvas
          const canvasElements = canvas.querySelectorAll(".canvas-element");
          generatedHtml += '    <div class="container">\n';

          canvasElements.forEach((element) => {
            const componentType = element.getAttribute("data-component-type");
            const componentElement =
              element.querySelector(`.component-${componentType}`) ||
              element.querySelector("input");
            const properties = JSON.parse(element.dataset.properties || "{}");

            if (componentElement) {
              // Create a clean clone without action buttons
              const clone = componentElement.cloneNode(true);

              // Add class based on component type
              clone.classList.add(`component-${componentType}`);

              // Add unique ID for the component
              clone.id = `generated-${componentType}-${
                element.id.split("-")[1]
              }`;

              generatedHtml += `        ${clone.outerHTML}\n`;
            }
          });

          generatedHtml += "    </div>\n</body>\n</html>";

          // Generate basic CSS
          let generatedCss = "/* Generated CSS */\n\n";
          generatedCss +=
            "* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\n";
          generatedCss +=
            "body {\n    font-family: Arial, sans-serif;\n    line-height: 1.6;\n    color: #333;\n    background-color: #f5f5f5;\n}\n\n";
          generatedCss +=
            ".container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 2rem;\n}\n\n";

          // Add component styles
          generatedCss += "/* Component Styles */\n";
          canvasElements.forEach((element) => {
            const componentType = element.getAttribute("data-component-type");
            const properties = JSON.parse(element.dataset.properties || "{}");
            const elementId = `generated-${componentType}-${
              element.id.split("-")[1]
            }`;

            generatedCss += `#${elementId} {\n`;

            // Add positioning
            generatedCss += `    position: relative;\n`;

            // Add properties based on component type
            for (const [key, value] of Object.entries(properties)) {
              if (
                key === "text" ||
                key === "content" ||
                key === "placeholder" ||
                key === "links" ||
                key === "brandText"
              ) {
                // Skip content properties
                continue;
              }

              let cssProperty = key.replace(/([A-Z])/g, "-$1").toLowerCase();
              let cssValue = value;

              // Handle special cases
              if (key === "fontSize" || key === "borderRadius") {
                cssValue = `${value}px`;
              } else if (key === "width" || key === "height") {
                if (!value.includes("%")) {
                  cssValue = `${value}px`;
                }
              }

              generatedCss += `    ${cssProperty}: ${cssValue};\n`;
            }

            generatedCss += "}\n\n";
          });

          // Set the code in textareas
          htmlCode.value = generatedHtml;
          cssCode.value = generatedCss;
        }

        // Save/Load functionality (using localStorage for simulation)
        function initSaveLoad() {
          saveBtn.addEventListener("click", function () {
            const canvasElements = canvas.querySelectorAll(".canvas-element");
            let savedElements = [];

            canvasElements.forEach((element) => {
              savedElements.push({
                id: element.id,
                type: element.getAttribute("data-component-type"),
                left: element.style.left,
                top: element.style.top,
                properties: JSON.parse(element.dataset.properties || "{}"),
              });
            });

            // Save to localStorage
            localStorage.setItem(
              "uiDesignerSave",
              JSON.stringify(savedElements)
            );
            alert("Project saved successfully!");
          });

          loadBtn.addEventListener("click", function () {
            const savedData = localStorage.getItem("uiDesignerSave");

            if (savedData) {
              try {
                const elements = JSON.parse(savedData);

                // Clear canvas
                canvas.innerHTML = "";

                // Load saved elements
                elements.forEach((el) => {
                  if (!componentTemplates[el.type]) return;

                  const element = document.createElement("div");
                  element.className = "canvas-element";
                  element.id = el.id;
                  element.setAttribute("data-component-type", el.type);
                  element.innerHTML = `
                            <div class="element-actions">
                                <button class="element-action-btn delete-btn" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="element-action-btn duplicate-btn" title="Duplicate">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            ${componentTemplates[el.type].html}
                        `;

                  // Set position
                  element.style.position = "absolute";
                  element.style.left = el.left;
                  element.style.top = el.top;

                  // Set properties
                  element.dataset.properties = JSON.stringify(el.properties);

                  canvas.appendChild(element);

                  // Apply visual properties
                  for (const [key, value] of Object.entries(el.properties)) {
                    updateElementProperty(element, key, value);
                  }

                  // Make element draggable
                  makeElementDraggable(element);

                  // Add event listeners for actions
                  setupElementActions(element);
                });

                // Update next element ID
                const ids = elements.map((el) => parseInt(el.id.split("-")[1]));
                nextElementId = Math.max(...ids, 0) + 1;

                alert("Project loaded successfully!");
              } catch (error) {
                console.error(error);
                alert("Error loading project!");
              }
            } else {
              alert("No saved project found!");
            }
          });
        }
      });

      // Initialize AI Improve button
      const aiImproveBtn = document.getElementById("ai-improve-btn");

      aiImproveBtn.addEventListener("click", function () {
        // Get the current HTML and CSS code
        const htmlContent = document.getElementById("html-code").value;
        const cssContent = document.getElementById("css-code").value;

        // Send the code to the backend for improvement
        fetch("/api/improve-code", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            html: htmlContent,
            css: cssContent,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Update the textareas with the improved code
              document.getElementById("html-code").value = data.html;
              document.getElementById("css-code").value = data.css;
              alert("Code improved successfully!");
            } else {
              alert("Failed to improve code.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("An error occurred while improving the code.");
          });
      });
    </script>
  </body>
</html>
